<div class="modal-header">
  <mat-card class="field-full-width">
    <div class="row">
      <div class="col-md-12">
        <h2 class="modal-title cursor-arrow" style="margin: 5px 0 0 0px;">
          {{ "COURSE.CURRENT_COURSE" | translate }}
        </h2>
      </div>
    </div>
  </mat-card>
</div>

<div class="container-fluid">
  <mat-card class="course-card" @fadeIn
    [style]="!course().status ? 'display: flex !important; flex-direction: column; justify-content: center; align-items: center;' : ''">
    <mat-card-header>
      <div class="header-content">
        @if (!showNoActive) {
          <span class="course-title">{{ course().configCourseName }}</span>
        }
        @if (showNoActive) {
          <span class="course-title" style="margin-top: 20px;">
            {{ "COURSE.CURRENT_COURSE_DETAIL" | translate }}
          </span>
        }
      </div>
    </mat-card-header>

    <mat-card-content>
      <mat-accordion multi>
        @for (section of modules(); track $index) {
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="module-row">
                <div class="module-title">{{ section.moduleName }}</div>

                @if (section.status !== 'NEW' && section.exam) {
                  <div class="lesson-meta">
                    <span [class]="section.status == 'APPROVED' ? 'preview_success' : 'preview_unsuccess'">
                      {{ section.status | stateModulePipe }}
                    </span>
                  </div>
                }

                @if (section.classes.length) {
                  <div class="lesson-meta">
                    {{ section.classes.length }} {{ "COURSE.CLASSES" | translate }}
                  </div>
                }
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>

          @if (section.classes.length) {
          <mat-list>
            @for (lesson of section.classes; track $index) {
            <mat-list-item disableRipple>
              <div class="lesson-row">
                @if (!lesson.viewed && lesson.currentImageId == 0) {
                  <mat-icon matTooltip="{{ 'COURSE.CLASS_NOT_VIEWED' | translate }}">visibility_off</mat-icon>
                }
                @if (lesson.viewed) {
                  <mat-icon style="color: #4caf50;" matTooltip="{{ 'COURSE.CLASS_VIEWED' | translate }}">visibility</mat-icon>
                }
                @if (!lesson.viewed && lesson.currentImageId !== 0) {
                  <mat-icon style="color: #be0808;" matTooltip="{{ 'COURSE.CLASS_IN_PROGRESS' | translate }}">visibility</mat-icon>
                }

                <div class="lesson-title">{{ lesson.title }}</div>

                <button mat-icon-button color="primary"
                        aria-label="{{ 'COURSE.VIEW_CLASS' | translate }}"
                        matTooltip="{{ 'COURSE.VIEW_CLASS' | translate }}"
                        (click)="actionPlayClass(lesson.id, lesson.configClassId, lesson.currentImageId, lesson.viewed)">
                  <mat-icon>play_circle</mat-icon>
                </button>
              </div>
            </mat-list-item>
            }
          </mat-list>
          }

          @if (section.exam) {
          <mat-list>
            <mat-list-item disableRipple>
              <div class="lesson-row">
                @if (section.exam.status == 'NEW') {
                  <mat-icon matTooltip="{{ 'COURSE.EXAM' | translate }}">description</mat-icon>
                }
                @if (section.exam.status == 'APPROVED') {
                  <mat-icon matTooltip="{{ 'COURSE.EXAM_APPROVED' | translate }}" style="color: #4caf50;">task</mat-icon>
                }
                @if (section.exam.status == 'NOT_APPROVED') {
                  <mat-icon matTooltip="{{ 'COURSE.EXAM_NOT_APPROVED' | translate }}" style="color: #be0808;">task</mat-icon>
                }

                <div class="lesson-title">{{ section.exam.title }}</div>

                <button mat-icon-button color="primary"
                        aria-label="{{ 'COURSE.TAKE_EXAM' | translate }}"
                        matTooltip="{{ 'COURSE.TAKE_EXAM' | translate }}"
                        (click)="actionViewExam(section.exam)"
                        [disabled]="section.exam.status !== 'NEW' || section.status=='APPROVED' || isAnyClassNotViewed(section.classes)">
                  <mat-icon>preview</mat-icon>
                </button>
              </div>
            </mat-list-item>
          </mat-list>
          }

          @if (section.references && section.moduleName == 'Referencias') {
          <mat-list>
            @for (reference of section.references; track $index) {
            <mat-list-item disableRipple style="margin-bottom: 1.5rem; height: auto;">
              <div class="reference-row">
                <mat-icon>language</mat-icon>
                <div class="lesson-title" style="text-wrap: auto;">
                  <a [href]="reference.link" target="_blank" style="cursor: pointer; text-wrap: auto;">
                    {{ reference.title }}
                  </a>
                </div>
              </div>
            </mat-list-item>
            }
          </mat-list>
          }

          @if (section.moduleName == 'Feedback') {
          <mat-list>
            <mat-list-item disableRipple>
              <div class="lesson-row">
                @if (section.status == 'APPROVED') {
                  <mat-icon matTooltip="{{ 'COURSE.FEEDBACK' | translate }}" style="color: #4caf50;">ballot</mat-icon>
                }
                @if (section.status !== 'APPROVED') {
                  <mat-icon matTooltip="{{ 'COURSE.FEEDBACK' | translate }}">ballot</mat-icon>
                }

                <div class="lesson-title">{{ 'COURSE.FEEDBACK_DETAIL' | translate }}</div>

                <button mat-icon-button color="primary"
                        aria-label="{{ 'COURSE.TAKE_FEEDBACK' | translate }}"
                        matTooltip="{{ 'COURSE.TAKE_FEEDBACK' | translate }}"
                        (click)="openFeedback(section.id)"
                        [disabled]="section.status !== 'NEW'">
                  <mat-icon>edit_note</mat-icon>
                </button>
              </div>
            </mat-list-item>
          </mat-list>
          }

        </mat-expansion-panel>
        }
      </mat-accordion>